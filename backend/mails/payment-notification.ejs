<%- include('base-template', { 
    subject: 'Payment Received',
    body: `
    <div class="section">
        <h2 class="section-title">üí∞ Payment Received!</h2>
        <p>Great news! A payment has been received for one of your invoices. Here are the details:</p>
    </div>

    <div class="amount-highlight">
        <div class="amount">${invoice.currency || '$'}${paymentDetails.amountPaid.toFixed(2)}</div>
        <div class="label">Payment Amount Received</div>
    </div>

    <div class="section">
        <h3 class="section-title">üìã Invoice Information</h3>
        <div class="info-grid">
            <div class="info-item">
                <div class="info-label">Invoice Number</div>
                <div class="info-value">#${invoice.invoiceNumber}</div>
            </div>
            <div class="info-item">
                <div class="info-label">Client Name</div>
                <div class="info-value">${invoice.client.name || 'N/A'}</div>
            </div>
            <div class="info-item">
                <div class="info-label">Client Email</div>
                <div class="info-value">${invoice.client.email}</div>
            </div>
            <div class="info-item">
                <div class="info-label">Invoice Total</div>
                <div class="info-value">${invoice.currency || '$'}${invoice.grandTotal.toFixed(2)}</div>
            </div>
        </div>
    </div>

    <div class="section">
        <h3 class="section-title">üí≥ Payment Details</h3>
        <div class="info-grid">
            <div class="info-item">
                <div class="info-label">Payment Type</div>
                <div class="info-value">${paymentDetails.paymentType === 'crypto' ? 'Cryptocurrency' : 'Bank Transfer'}</div>
            </div>
            <div class="info-item">
                <div class="info-label">Amount Paid</div>
                <div class="info-value">${invoice.currency || '$'}${paymentDetails.amountPaid.toFixed(2)}</div>
            </div>
            <div class="info-item">
                <div class="info-label">Payment Date</div>
                <div class="info-value">${new Date(paymentDetails.paymentDate).toLocaleDateString()}</div>
            </div>
            <div class="info-item">
                <div class="info-label">Remaining Balance</div>
                <div class="info-value">${invoice.currency || '$'}${invoice.remainingAmount.toFixed(2)}</div>
            </div>
        </div>
    </div>

    ${paymentDetails.paymentType === 'crypto' ? `
    <div class="section">
        <h3 class="section-title">üîê Crypto Payment Information</h3>
        <div class="info-grid">
            <div class="info-item">
                <div class="info-label">Payer Wallet</div>
                <div class="info-value" style="font-family: monospace; font-size: 12px;">${paymentDetails.payerWalletAddr}</div>
            </div>
            <div class="info-item">
                <div class="info-label">Transaction Hash</div>
                <div class="info-value" style="font-family: monospace; font-size: 12px;">${paymentDetails.txnHash}</div>
            </div>
            <div class="info-item">
                <div class="info-label">Crypto Token</div>
                <div class="info-value">${paymentDetails.cryptoToken}</div>
            </div>
            ${paymentDetails.nftReceiptId ? `
            <div class="info-item">
                <div class="info-label">NFT Receipt ID</div>
                <div class="info-value">${paymentDetails.nftReceiptId}</div>
            </div>
            ` : ''}
        </div>
        <p style="margin-top: 15px; color: #666; font-size: 14px;">
            <strong>Note:</strong> This crypto payment has been automatically verified and processed. 
            The transaction is confirmed on the blockchain and cannot be reversed.
        </p>
    </div>
    ` : ''}

    ${paymentDetails.paymentType === 'bank' ? `
    <div class="section">
        <h3 class="section-title">üè¶ Bank Payment Information</h3>
        <div class="info-grid">
            <div class="info-item">
                <div class="info-label">Payer Wallet (if provided)</div>
                <div class="info-value">${paymentDetails.payerWalletAddr || 'Not provided'}</div>
            </div>
            <div class="info-item">
                <div class="info-label">Verification Status</div>
                <div class="info-value">
                    <span class="status-badge status-pending">Pending Verification</span>
                </div>
            </div>
        </div>
        <p style="margin-top: 15px; color: #666; font-size: 14px;">
            <strong>Note:</strong> This bank payment requires manual verification. 
            Please review the payment details and verify the transaction in your admin panel.
        </p>
    </div>
    ` : ''}

    ${paymentDetails.note ? `
    <div class="section">
        <h3 class="section-title">üìù Payment Note</h3>
        <div style="background-color: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #667eea;">
            <p style="margin: 0; color: #34495e;">${paymentDetails.note}</p>
        </div>
    </div>
    ` : ''}

    <div class="section">
        <h3 class="section-title">üìä Updated Invoice Status</h3>
        <div class="info-grid">
            <div class="info-item">
                <div class="info-label">Total Amount</div>
                <div class="info-value">${invoice.currency || '$'}${invoice.grandTotal.toFixed(2)}</div>
            </div>
            <div class="info-item">
                <div class="info-label">Total Received</div>
                <div class="info-value">${invoice.currency || '$'}${invoice.totalAmountReceived.toFixed(2)}</div>
            </div>
            <div class="info-item">
                <div class="info-label">Remaining Balance</div>
                <div class="info-value">${invoice.currency || '$'}${invoice.remainingAmount.toFixed(2)}</div>
            </div>
            <div class="info-item">
                <div class="info-label">Current Status</div>
                <div class="info-value">
                    ${invoice.invoiceStatus === 'Paid' ? '<span class="status-badge status-paid">Paid</span>' : 
                      invoice.invoiceStatus === 'Partially Paid' ? '<span class="status-badge status-partial">Partially Paid</span>' : 
                      '<span class="status-badge status-pending">Pending</span>'}
                </div>
            </div>
        </div>
    </div>

    ${invoice.recurring && invoice.recurring.isRecurring && invoice.invoiceStatus === 'Paid' ? `
    <div class="section" style="background-color: #e8f5e8; padding: 20px; border-radius: 8px; border-left: 4px solid #27ae60;">
        <h3 class="section-title" style="color: #27ae60;">üîÑ Recurring Invoice Generated</h3>
        <p style="margin: 0; color: #27ae60;">
            Since this invoice is now fully paid, the next recurring invoice has been automatically generated 
            and will be sent to the client. The recurring cycle continues as scheduled.
        </p>
    </div>
    ` : ''}

    <div class="section" style="text-align: center;">
        <h3 class="section-title">üì± Manage Your Invoice</h3>
        <p style="margin-bottom: 20px;">Click the button below to view the complete invoice details and manage payments.</p>
        <a href="${invoiceUrl}" class="cta-button">View Invoice</a>
    </div>

    <div class="section">
        <h3 class="section-title">‚ö†Ô∏è Important Notes</h3>
        <ul style="color: #666; line-height: 1.8;">
            <li>This payment has been automatically recorded in your system</li>
            <li>For bank payments, manual verification may be required</li>
            <li>Keep this notification for your records</li>
            <li>Contact support if you notice any discrepancies</li>
        </ul>
    </div>

    <div class="section" style="background-color: #f8f9fa; padding: 20px; border-radius: 8px; text-align: center;">
        <p style="margin: 0; color: #666; font-size: 14px;">
            <strong>Thank you for using VPay!</strong><br>
            We're here to help you manage your invoicing and payments efficiently.
        </p>
    </div>
    `
}) %> 